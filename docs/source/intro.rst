
.. role:: raw-latex(raw)
    :format: latex


Introduction
=====================

Application of computational codes often implies preparation of text input
files. In a simple case, an input file can be written by hands, but often the
amount of details to be passed to a code makes an input file long and complex
so that the write-by-hands approach becomes almost impossible. Some codes
provide means to simplify preparation of input files, for example, by allowing
inclusion of external files, or by providing syntax to define variables that
can be referenced later instead of explicit input data, but usually such
possibilities are rather limited. 

A widely used approach to create complex input files is to write a program that
generates it. This approach has some drawbacks. Input files generated
programmatically are usually very case-specific and even a small extension of
the computational model might imply considerable changes in the program.
Another drawback is that some parts of an input file can be rather simple and
it is much more convenient to write it by hands than to write a programm that
generate these simple parts.

Another approach that partly resolves the latter problem is to use templates.
The generating program computes necessary data and inserts them into a template
file that is prepared in advance. Thus, some parts of the input file can be
written by hands to the template, and generation of the rest can be coded. In
this approach one needs to define an algorithm to find places for insertion.
The simplets way -- to insert something into a predefined line and position,
makes it difficult to change the template later on. More sophisticated algorithms,
such as using particular strings in the template file to be replaced by the
program are difficult to apply especially if the amount of inserted data is
large. Another drawback of this approach is that information needed to write
the input file is located at at least two different places: in the template
file and in the program.

We propose a concept that is an extension of the concept of templates and
resembles the idea of literate programming :raw-latex:`\cite{literateWEB}`.
Accoring to this concept, the template file contains both parts written by
hands that is transferred to the input file unchanged, and parts containing
code chunks that will be substituted by the result of their evaluation during
preprocessing. Thus, the template file contains all the information necessary
to produce an input file, and places where evaluation result must be inserted
is defined naturally by the place where the code chunks are found in the
template.

Software that supports this concept is implemented in the Python programming
language :raw-latex:`\cite{pythonWEB}`. It is distributed as a Python package
called TSP (stands for "Text with Snippets Preprocessor") and can be installed
onto any machine where Python is installed (tested on Windows 7 and Linux OS).
The TSP package provides an executable that takes a text file as input,
searches for pieces of Python code in it, executes these code chunks  and writes an
output text file that is a copy of the input text file, but with the Python
code pieces substituted with the result of their evaluation. 

This report explains the installation procedure of the TSP package, describes
the syntax of the template file and gives some examples of the usage of TSP.

In the rest of the report, the following terminology is used. A file containing
text and Python code pieces is called **template file**, or just **template**. Pieces
of Python code inside a template are called **snippets**.  The output file
generated by processing of an template, is called **resulting file**. The script
provided by the TSP package that reads a template file and generates
correspondent resulting file, is called **preprocessor**.

To illustrate what the TSP package can be used for, consider the example that shows
the template file on the left and the resulting file on the right:

.. list-table::
    :header-rows: 1

    * - Template
      - Resulting file
    * - .. literalinclude:: examples/intro.t
      - .. literalinclude:: examples/intro.t.res

The template's first line contains two quotes, ``'``,
they will be used in the rest of the template to define the beginning and end of 
snippets. The first line is never copied to the resulting file.

The first snippet, ``'pi=3.14159'`` is a valid Python statement defining
variable ``pi``. This snippet produces no output, its content is just copied
into the resulting file, but the variable ``pi`` can be used later on.

The next snippet, ``'pi*2'``, is a valid Python expression. It can be
evaluated, and in the resulting file its code is substituted with the string
representation of the result of evaluation.

The next snippet, starting with statement ``from math import cos``, takes
several lines and represents a valid Python script that can be executed. This
snippet contains print statements that generates some standard output that,
together with the snippet's code, will appear in the resulting file. 

Note that the structure of the template is accurately repeated in the resulting
file. Results of snippets evaluation appears exactly at places where the
snippets were written in the template.  Variables defined in previous snippets
can be used in the following snippets. String representation of snippet
evaluation can be controlled with optional snippet keys. Multi-line snippets
can be commented out in the resulting file. A snippet can be as simple as an
in-line reference to a variable, or it can represent a complete Python script,
thus, the whole power of Python ans its packages can be used to facilitate
preparation of input files.


